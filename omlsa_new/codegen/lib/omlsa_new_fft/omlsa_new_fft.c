/*
 * File: omlsa_new_fft.c
 *
 * MATLAB Coder version            : 3.1
 * C/C++ source code generated on  : 09-Nov-2018 14:14:28
 */

/* Include Files */
#include "rt_nonfinite.h"
#include "omlsa_new_fft.h"
#include "ifft.h"
#include "fft.h"
#include "any.h"
#include "omlsa_new_fft_emxutil.h"
#include "abs.h"
#include "mean.h"

/* Function Declarations */
static void lnshift(double t, double y_data[], int y_size[1]);

/* Function Definitions */

/*
 * lnshift -- t circular left shift of 1-d signal
 *   Usage
 *     y = lnshift(x,t)
 *   Inputs
 *     x   1-d signal
 *   Outputs
 *     y   1-d signal
 *         y(i) = x(i+t) for i+t < n
 *     y(i) = x(i+t-n) else
 *
 *  Copyright (c) 2000. Prof Israel Cohen.
 *  All rights reserved.
 *  ***************************************************************@
 * Arguments    : double t
 *                double y_data[]
 *                int y_size[1]
 * Return Type  : void
 */
static void lnshift(double t, double y_data[], int y_size[1])
{
  int loop_ub;
  int i2;
  static const double x[512] = { 0.0064000000000000029, 0.006405564865325921,
    0.0064222731285066966, 0.0064501657803114126, 0.0064893111025623885,
    0.0065398046139702633, 0.0066017689943516653, 0.0066753539872780676,
    0.0067607362812182031, 0.00685811936925012, 0.0069677333874328768,
    0.007089834931941358, 0.0072247068550814935, 0.0073726580403164679,
    0.0075340231564482935, 0.0077091623911121829, 0.0078984611637546963,
    0.0081023298182795554, 0.00832120329555837, 0.0085555407860162247,
    0.0088058253625149154, 0.0090725635937695618, 0.00935628513854644,
    0.0096575423209025232, 0.0099769096867396018, 0.010314983541957225,
    0.010672381472501644, 0.011049741846618453, 0.011447723299629158,
    0.011867004201562625, 0.012308282107983393, 0.012772273194370458,
    0.013259711674409683, 0.013771349202574695, 0.014307954261380228,
    0.014870311533702737, 0.015459221260572186, 0.01607549858484909,
    0.016719972881209293, 0.017393487072868988, 0.018096896935490072,
    0.01883107038871534, 0.019596886775790877, 0.020395236131740307,
    0.02122701844056438, 0.022093142881945468, 0.022994527067944574,
    0.023932096270184174, 0.024906782638017672, 0.025919524408191737,
    0.02697126510651348, 0.028062952742040466, 0.029195538994316182,
    0.030369978394178994, 0.03158722749867629, 0.032848244060620792,
    0.03415398619332901, 0.035505411531085558, 0.036903476385880721,
    0.038349134900970874, 0.039843338201814134, 0.041387033544935892,
    0.042981163465280921, 0.044626664922609319, 0.046324468447496034,
    0.048075497287493621, 0.049880666554018321, 0.051740882370520332,
    0.053657041022498249, 0.05563002810991749, 0.05766071770259136,
    0.059749971499082184, 0.061898637989678672, 0.064107551624003112,
    0.066377531983800225, 0.068709382961456622, 0.071103891944796854,
    0.073561829008699162, 0.076083946114068948, 0.0786709763147068,
    0.081323632972600007, 0.0840426089821648, 0.086828576003960628,
    0.089682183708391428, 0.09260405902990522, 0.095594805432195659,
    0.098655002184903584, 0.10178520365231158, 0.10498593859451376,
    0.10825770948154077, 0.1116009918209087, 0.1150162334990546,
    0.11850385413711334, 0.12206424446148116, 0.12569776568960395,
    0.12940474893141871, 0.13318549460686685, 0.13704027187989093,
    0.14096931810931324, 0.14497283831698915, 0.14905100467361221,
    0.15320395600254522, 0.15743179730203211, 0.16173459928614262,
    0.16611239794478541, 0.17056519412311588, 0.17509295312065404,
    0.17969560431041434, 0.18437304077834, 0.18912511898331896,
    0.19395165843805023, 0.19885244141101302, 0.20382721264978237,
    0.20887567912591848, 0.21399750980164781, 0.21919233541853717,
    0.22445974830835239, 0.22979930222627765, 0.23521051220665823,
    0.240692854441418, 0.24624576618128613, 0.25186864565995759,
    0.25756085204129375, 0.26332170538966049, 0.26915048666348318,
    0.27504643773208592, 0.28100876141586889, 0.2870366215498607,
    0.29312914307067417, 0.29928541212687176, 0.30550447621274074,
    0.31178534432545935, 0.31812698714562149, 0.32452833724107549,
    0.3309882892940153, 0.33750570035125288, 0.34407939009757876,
    0.35070814115211529, 0.35739069938753937, 0.36412577427205073,
    0.37091203923393745, 0.37774813204858471, 0.384632655247752,
    0.3915641765509375, 0.39854122931862779, 0.40556231302722451,
    0.41262589376542114, 0.4197304047517908, 0.42687424687333864,
    0.43405578924474864, 0.4412733697880537, 0.44852529583243655,
    0.45580984473386171, 0.46312526451422431, 0.47046977451969052,
    0.47784156609789097, 0.48523880329362057, 0.49265962356268045,
    0.5001021385034935, 0.50756443460610989, 0.51504457401820869,
    0.52254059532769, 0.53005051436144746, 0.53757232499989249,
    0.545104000006796, 0.5526434918740093, 0.56018873368060151,
    0.56773763996596216, 0.57528810761638716, 0.58283801676467817,
    0.59038523170226043, 0.59792760180332749, 0.60546296246050935,
    0.6129891360315487, 0.62050393279647731, 0.62800515192475392,
    0.63549058245184975, 0.64295800426472782, 0.65040518909568557,
    0.65782990152400944, 0.66522989998488058, 0.672602937784986,
    0.67994676412426225, 0.68725912512320975, 0.69453776485520435,
    0.70178042638323423, 0.708984852800484, 0.71614878827418194,
    0.72326997909213719, 0.73034617471136876, 0.73737512880825262,
    0.74435460032958956, 0.75128235454401016, 0.75815616409312414,
    0.76497381004182385, 0.77173308292715537, 0.7784317838051602,
    0.78506772529510693, 0.7916387326205151, 0.79814264464639328,
    0.804577314912101, 0.81094061265924988, 0.81723042385407085,
    0.82344465220365815, 0.82958122016552782, 0.83563806994990741,
    0.84161316451419732, 0.84750448854903793, 0.85331004945542144,
    0.85902787831229543, 0.86465603083411, 0.87019258831776491,
    0.87563565857841308, 0.88098337687359829, 0.88623390681519121,
    0.89138544126861408, 0.89643620323883455, 0.901384446742629,
    0.90622845766661608, 0.91096655461057585, 0.91559708971556342,
    0.92011844947635935, 0.92452905553777942, 0.9288273654744007,
    0.93301187355324988, 0.93708111147902384, 0.94103364912141563,
    0.94486809522412862, 0.94858309809517682, 0.9521773462780716,
    0.95564956920351773, 0.95899853782124012, 0.96222306521158307,
    0.96532200717653172, 0.96829426280981612, 0.9711387750457724,
    0.97385453118664789, 0.97644056340804586, 0.97889594924222345,
    0.981219812038961, 0.9834113214037471, 0.98546969361301673,
    0.9873941920062177, 0.98918412735446837, 0.9908388582056028,
    0.99235779120540579, 0.99374038139484755, 0.99498613248315515,
    0.99609459709655657, 0.99706537700256281, 0.99789812330965111,
    0.99859253664224346, 0.99914836729086942, 0.99956541533743926,
    0.99984353075554455, 0.99998261348573747, 0.99998261348573747,
    0.99984353075554455, 0.99956541533743926, 0.99914836729086942,
    0.99859253664224346, 0.99789812330965111, 0.99706537700256281,
    0.99609459709655657, 0.99498613248315515, 0.99374038139484755,
    0.99235779120540579, 0.9908388582056028, 0.98918412735446837,
    0.9873941920062177, 0.98546969361301673, 0.9834113214037471,
    0.981219812038961, 0.97889594924222345, 0.97644056340804586,
    0.97385453118664789, 0.9711387750457724, 0.96829426280981612,
    0.96532200717653172, 0.96222306521158307, 0.95899853782124012,
    0.95564956920351773, 0.9521773462780716, 0.94858309809517682,
    0.94486809522412862, 0.94103364912141563, 0.93708111147902384,
    0.93301187355324988, 0.9288273654744007, 0.92452905553777942,
    0.92011844947635935, 0.91559708971556342, 0.91096655461057585,
    0.90622845766661608, 0.901384446742629, 0.89643620323883455,
    0.89138544126861408, 0.88623390681519121, 0.88098337687359829,
    0.87563565857841308, 0.87019258831776491, 0.86465603083411,
    0.85902787831229543, 0.85331004945542144, 0.84750448854903793,
    0.84161316451419732, 0.83563806994990741, 0.82958122016552782,
    0.82344465220365815, 0.81723042385407085, 0.81094061265924988,
    0.804577314912101, 0.79814264464639328, 0.7916387326205151,
    0.78506772529510693, 0.7784317838051602, 0.77173308292715537,
    0.76497381004182385, 0.75815616409312414, 0.75128235454401016,
    0.74435460032958956, 0.73737512880825262, 0.73034617471136876,
    0.72326997909213719, 0.71614878827418194, 0.708984852800484,
    0.70178042638323423, 0.69453776485520435, 0.68725912512320975,
    0.67994676412426225, 0.672602937784986, 0.66522989998488058,
    0.65782990152400944, 0.65040518909568557, 0.64295800426472782,
    0.63549058245184975, 0.62800515192475392, 0.62050393279647731,
    0.6129891360315487, 0.60546296246050935, 0.59792760180332749,
    0.59038523170226043, 0.58283801676467817, 0.57528810761638716,
    0.56773763996596216, 0.56018873368060151, 0.5526434918740093,
    0.545104000006796, 0.53757232499989249, 0.53005051436144746,
    0.52254059532769, 0.51504457401820869, 0.50756443460610989,
    0.5001021385034935, 0.49265962356268045, 0.48523880329362057,
    0.47784156609789097, 0.47046977451969052, 0.46312526451422431,
    0.45580984473386171, 0.44852529583243655, 0.4412733697880537,
    0.43405578924474864, 0.42687424687333864, 0.4197304047517908,
    0.41262589376542114, 0.40556231302722451, 0.39854122931862779,
    0.3915641765509375, 0.384632655247752, 0.37774813204858471,
    0.37091203923393745, 0.36412577427205073, 0.35739069938753937,
    0.35070814115211529, 0.34407939009757876, 0.33750570035125288,
    0.3309882892940153, 0.32452833724107549, 0.31812698714562149,
    0.31178534432545935, 0.30550447621274074, 0.29928541212687176,
    0.29312914307067417, 0.2870366215498607, 0.28100876141586889,
    0.27504643773208592, 0.26915048666348318, 0.26332170538966049,
    0.25756085204129375, 0.25186864565995759, 0.24624576618128613,
    0.240692854441418, 0.23521051220665823, 0.22979930222627765,
    0.22445974830835239, 0.21919233541853717, 0.21399750980164781,
    0.20887567912591848, 0.20382721264978237, 0.19885244141101302,
    0.19395165843805023, 0.18912511898331896, 0.18437304077834,
    0.17969560431041434, 0.17509295312065404, 0.17056519412311588,
    0.16611239794478541, 0.16173459928614262, 0.15743179730203211,
    0.15320395600254522, 0.14905100467361221, 0.14497283831698915,
    0.14096931810931324, 0.13704027187989093, 0.13318549460686685,
    0.12940474893141871, 0.12569776568960395, 0.12206424446148116,
    0.11850385413711334, 0.1150162334990546, 0.1116009918209087,
    0.10825770948154077, 0.10498593859451376, 0.10178520365231158,
    0.098655002184903584, 0.095594805432195659, 0.09260405902990522,
    0.089682183708391428, 0.086828576003960628, 0.0840426089821648,
    0.081323632972600007, 0.0786709763147068, 0.076083946114068948,
    0.073561829008699162, 0.071103891944796854, 0.068709382961456622,
    0.066377531983800225, 0.064107551624003112, 0.061898637989678672,
    0.059749971499082184, 0.05766071770259136, 0.05563002810991749,
    0.053657041022498249, 0.051740882370520332, 0.049880666554018321,
    0.048075497287493621, 0.046324468447496034, 0.044626664922609319,
    0.042981163465280921, 0.041387033544935892, 0.039843338201814134,
    0.038349134900970874, 0.036903476385880721, 0.035505411531085558,
    0.03415398619332901, 0.032848244060620792, 0.03158722749867629,
    0.030369978394178994, 0.029195538994316182, 0.028062952742040466,
    0.02697126510651348, 0.025919524408191737, 0.024906782638017672,
    0.023932096270184174, 0.022994527067944574, 0.022093142881945468,
    0.02122701844056438, 0.020395236131740307, 0.019596886775790877,
    0.01883107038871534, 0.018096896935490072, 0.017393487072868988,
    0.016719972881209293, 0.01607549858484909, 0.015459221260572186,
    0.014870311533702737, 0.014307954261380228, 0.013771349202574695,
    0.013259711674409683, 0.012772273194370458, 0.012308282107983393,
    0.011867004201562625, 0.011447723299629158, 0.011049741846618453,
    0.010672381472501644, 0.010314983541957225, 0.0099769096867396018,
    0.0096575423209025232, 0.00935628513854644, 0.0090725635937695618,
    0.0088058253625149154, 0.0085555407860162247, 0.00832120329555837,
    0.0081023298182795554, 0.0078984611637546963, 0.0077091623911121829,
    0.0075340231564482935, 0.0073726580403164679, 0.0072247068550814935,
    0.007089834931941358, 0.0069677333874328768, 0.00685811936925012,
    0.0067607362812182031, 0.0066753539872780676, 0.0066017689943516653,
    0.0065398046139702633, 0.0064893111025623885, 0.0064501657803114126,
    0.0064222731285066966, 0.006405564865325921, 0.0064000000000000029 };

  y_size[0] = ((int)t - (int)(1.0 + t)) + 513;
  loop_ub = 513 - (int)(1.0 + t);
  for (i2 = 0; i2 < loop_ub; i2++) {
    y_data[i2] = x[((int)(1.0 + t) + i2) - 1];
  }

  loop_ub = (int)t;
  for (i2 = 0; i2 < loop_ub; i2++) {
    y_data[(i2 - (int)(1.0 + t)) + 513] = x[i2];
  }
}

/*
 * omlsa : Single Channel OM-LSA with IMCRA noise estimator
 *  ***************************************************************@
 *  Inputs:
 *     fin,  input file name (fin.wav)
 *     fout, output file name (fout.wav)
 *  Output:
 *     in,  samples of the input file
 *     out, samples of the output file
 *  Usage:
 *     [in, out]=omlsa(fin,fout);
 *     omlsa(fin);
 *  Defaults:
 *     fout= [fin,'_omlsa'];
 *
 *  Copyright (c) 2003. Prof Israel Cohen.
 *  All rights reserved.
 *  ***************************************************************@
 * Arguments    : const double Y_BUF[512000]
 *                emxArray_real_T *y
 *                double out[512]
 * Return Type  : void
 */
void omlsa_new_fft(const double Y_BUF[512000], emxArray_real_T *y, double out
                   [512])
{
  double W0[128];
  static const double dv0[128] = { 0.0064000000000000029, 0.006405564865325921,
    0.0064222731285066966, 0.0064501657803114126, 0.0064893111025623885,
    0.0065398046139702633, 0.0066017689943516653, 0.0066753539872780676,
    0.0067607362812182031, 0.00685811936925012, 0.0069677333874328768,
    0.007089834931941358, 0.0072247068550814935, 0.0073726580403164679,
    0.0075340231564482935, 0.0077091623911121829, 0.0078984611637546963,
    0.0081023298182795554, 0.00832120329555837, 0.0085555407860162247,
    0.0088058253625149154, 0.0090725635937695618, 0.00935628513854644,
    0.0096575423209025232, 0.0099769096867396018, 0.010314983541957225,
    0.010672381472501644, 0.011049741846618453, 0.011447723299629158,
    0.011867004201562625, 0.012308282107983393, 0.012772273194370458,
    0.013259711674409683, 0.013771349202574695, 0.014307954261380228,
    0.014870311533702737, 0.015459221260572186, 0.01607549858484909,
    0.016719972881209293, 0.017393487072868988, 0.018096896935490072,
    0.01883107038871534, 0.019596886775790877, 0.020395236131740307,
    0.02122701844056438, 0.022093142881945468, 0.022994527067944574,
    0.023932096270184174, 0.024906782638017672, 0.025919524408191737,
    0.02697126510651348, 0.028062952742040466, 0.029195538994316182,
    0.030369978394178994, 0.03158722749867629, 0.032848244060620792,
    0.03415398619332901, 0.035505411531085558, 0.036903476385880721,
    0.038349134900970874, 0.039843338201814134, 0.041387033544935892,
    0.042981163465280921, 0.044626664922609319, 0.046324468447496034,
    0.048075497287493621, 0.049880666554018321, 0.051740882370520332,
    0.053657041022498249, 0.05563002810991749, 0.05766071770259136,
    0.059749971499082184, 0.061898637989678672, 0.064107551624003112,
    0.066377531983800225, 0.068709382961456622, 0.071103891944796854,
    0.073561829008699162, 0.076083946114068948, 0.0786709763147068,
    0.081323632972600007, 0.0840426089821648, 0.086828576003960628,
    0.089682183708391428, 0.09260405902990522, 0.095594805432195659,
    0.098655002184903584, 0.10178520365231158, 0.10498593859451376,
    0.10825770948154077, 0.1116009918209087, 0.1150162334990546,
    0.11850385413711334, 0.12206424446148116, 0.12569776568960395,
    0.12940474893141871, 0.13318549460686685, 0.13704027187989093,
    0.14096931810931324, 0.14497283831698915, 0.14905100467361221,
    0.15320395600254522, 0.15743179730203211, 0.16173459928614262,
    0.16611239794478541, 0.17056519412311588, 0.17509295312065404,
    0.17969560431041434, 0.18437304077834, 0.18912511898331896,
    0.19395165843805023, 0.19885244141101302, 0.20382721264978237,
    0.20887567912591848, 0.21399750980164781, 0.21919233541853717,
    0.22445974830835239, 0.22979930222627765, 0.23521051220665823,
    0.240692854441418, 0.24624576618128613, 0.25186864565995759,
    0.25756085204129375, 0.26332170538966049, 0.26915048666348318,
    0.27504643773208592, 0.28100876141586889, 0.2870366215498607 };

  int k;
  double b_W0;
  double swin2_data[768];
  int swin2_size[1];
  double win[512];
  int i0;
  int i;
  static const double A[512] = { 0.080000000000000016, 0.080034772851092173,
    0.080139086147189731, 0.080312924117550422, 0.0805562604802531,
    0.08086905844617126, 0.081251270724534919, 0.0817028395300804,
    0.082223696591786744, 0.082813763163197218, 0.083472950034324755,
    0.084201157545139238, 0.084998275600634943, 0.085864183687475115,
    0.086798750892212118, 0.0878018359210796, 0.0888732871213544,
    0.0900129425042841, 0.091220629769577732, 0.092496166331455187,
    0.093839359346251483, 0.09525000574157233, 0.09672789224699585,
    0.09827279542631584, 0.099884481711322914, 0.10156270743711604,
    0.10330721887894206, 0.10511775229055487, 0.10699403394409035,
    0.10893578017145067, 0.11094269740719032, 0.11301448223289995,
    0.11515082142307836, 0.11735139199248851, 0.11961586124498802,
    0.12194388682382867, 0.12433511676341558, 0.12678918954252011,
    0.12930573413893637, 0.1318843700855753, 0.13452470752798562,
    0.13722634728329447, 0.13998888090055894, 0.1428118907225176,
    0.14569494994873494, 0.14863762270012754, 0.1516394640848634,
    0.15470002026562302, 0.15781882852821355, 0.16099541735152506,
    0.16422930647881784, 0.16752000699033076, 0.170867021377199,
    0.17426984361667108, 0.177727959248612, 0.18124084545328295,
    0.18480797113038444, 0.18842879697935122, 0.19210277558088723,
    0.19582935147972808, 0.19960796126861807, 0.20343803367348962,
    0.20731898963983236, 0.211250242420238, 0.21523119766310839,
    0.2192612535025138, 0.2233398006491864, 0.22746622248263659,
    0.23163989514437761, 0.23586018763224431, 0.24012646189579223,
    0.24443807293276182, 0.24879436888659412, 0.25319469114498255,
    0.25763837443944609, 0.26212474694590859, 0.26665313038626953,
    0.27122284013095055, 0.27583318530240147, 0.28048346887955233,
    0.28517298780319289, 0.2899010330822655, 0.29466688990105527,
    0.29946983772726, 0.3043091504209251, 0.30918409634422606,
    0.31409393847208128, 0.31903793450358153, 0.32401533697421447,
    0.32902539336887171, 0.33406734623561862, 0.3391404333002106,
    0.34424388758133867, 0.34937693750658638, 0.354538807029081,
    0.35972871574482168, 0.36494587901066489, 0.3701895080629527,
    0.37545881013676219, 0.38075298858576168, 0.38607124300265128,
    0.39141276934017522, 0.39677676003268147, 0.40216240411821519,
    0.407568887361125, 0.41299539237516425, 0.41844109874706864,
    0.42390518316059117, 0.4293868195209769, 0.43488517907985663,
    0.44039943056054265, 0.4459287402837061, 0.45147227229341824,
    0.45702918848353491, 0.46259864872440754, 0.46817981098989858,
    0.4737718314846846, 0.47937386477182675, 0.48498506390058882,
    0.490604580534485, 0.49623156507953636, 0.50186516681271831,
    0.50750453401057782, 0.51314881407800261, 0.51879715367712187,
    0.524448698856319, 0.53010259517933778, 0.53575798785446094,
    0.54141402186374354, 0.5470698420922796, 0.55272459345748381,
    0.5583774210383684, 0.56402747020479549, 0.56967388674668551,
    0.57531581700316159, 0.58095240799161241, 0.58658280753665015,
    0.59220616439894924, 0.59782162840394071, 0.60342835057034794,
    0.60902548323854022, 0.61461218019868813, 0.62018759681869806,
    0.62575089017190977, 0.63130121916453463, 0.636837744662818,
    0.64235962961990467, 0.6478660392023885, 0.65335614091652849,
    0.65882910473410983, 0.66428410321793319, 0.6697203116469117,
    0.67513690814075755, 0.68053307378423888, 0.68590799275098879,
    0.69126085242684687, 0.69659084353271583, 0.70189716024691284,
    0.70717900032699887, 0.712435565231067, 0.717666060238471,
    0.72286969456997574, 0.72804568150731275, 0.73319323851212137,
    0.73831158734425673, 0.74339995417945059, 0.74845756972630151,
    0.75348366934258248, 0.758477493150843, 0.76343828615329357,
    0.7683652983459498, 0.77325778483202323, 0.77811500593454008,
    0.78293622730816892, 0.78772072005024552, 0.7924677608109707,
    0.79717663190277332, 0.80184662140881269, 0.80647702329061155,
    0.81106713749480042, 0.815616270058954, 0.82012373321651044,
    0.82458884550075151, 0.82901093184783137, 0.83338932369883667,
    0.83772335910086348, 0.84201238280709623, 0.84625574637587064,
    0.85045280826871117, 0.85460293394732079, 0.85870549596951606,
    0.86275987408408694, 0.86676545532457061, 0.8707216341019236,
    0.87462781229607822, 0.87848339934637087, 0.88228781234082576,
    0.88604047610428438, 0.88974082328536275, 0.89338829444222811,
    0.89698233812717909, 0.90052241097001573, 0.90400797776019148,
    0.90743851152772781, 0.91081349362288644, 0.91413241379458121,
    0.91739477026752081, 0.92060006981807141, 0.92374782784882448,
    0.92683756846186127, 0.9298688245307023, 0.93284113777093092,
    0.93575405880947859, 0.938607147252565, 0.94139997175227874,
    0.94413211007179187, 0.94680314914919594, 0.94941268515995136,
    0.95196032357793992, 0.95444567923511281, 0.956868376379721,
    0.9592280487331255, 0.96152433954517214, 0.96375690164812866,
    0.965925397509171, 0.96802949928141335, 0.970068888853475,
    0.97204325789757351, 0.97395230791614062, 0.97579575028695,
    0.97757330630675354, 0.97928470723341743, 0.98092969432655219,
    0.98250801888663064, 0.98401944229258809, 0.98546373603789827,
    0.98684068176512052, 0.98815007129891252, 0.98939170667750365,
    0.99056540018262351, 0.99167097436788332, 0.99270826208560226,
    0.99367710651207908, 0.99457736117130091, 0.99540888995708832,
    0.9961715671536735, 0.99686527745470577, 0.99748991598068559,
    0.99804538829481926, 0.9985316104172981, 0.99894850883799369,
    0.99929602052757294, 0.99957409294702582, 0.99978268405560977,
    0.99992176231720475, 0.99999130670508207, 0.99999130670508207,
    0.99992176231720475, 0.99978268405560977, 0.99957409294702582,
    0.99929602052757294, 0.99894850883799369, 0.9985316104172981,
    0.99804538829481926, 0.99748991598068559, 0.99686527745470577,
    0.9961715671536735, 0.99540888995708832, 0.99457736117130091,
    0.99367710651207908, 0.99270826208560226, 0.99167097436788332,
    0.99056540018262351, 0.98939170667750365, 0.98815007129891252,
    0.98684068176512052, 0.98546373603789827, 0.98401944229258809,
    0.98250801888663064, 0.98092969432655219, 0.97928470723341743,
    0.97757330630675354, 0.97579575028695, 0.97395230791614062,
    0.97204325789757351, 0.970068888853475, 0.96802949928141335,
    0.965925397509171, 0.96375690164812866, 0.96152433954517214,
    0.9592280487331255, 0.956868376379721, 0.95444567923511281,
    0.95196032357793992, 0.94941268515995136, 0.94680314914919594,
    0.94413211007179187, 0.94139997175227874, 0.938607147252565,
    0.93575405880947859, 0.93284113777093092, 0.9298688245307023,
    0.92683756846186127, 0.92374782784882448, 0.92060006981807141,
    0.91739477026752081, 0.91413241379458121, 0.91081349362288644,
    0.90743851152772781, 0.90400797776019148, 0.90052241097001573,
    0.89698233812717909, 0.89338829444222811, 0.88974082328536275,
    0.88604047610428438, 0.88228781234082576, 0.87848339934637087,
    0.87462781229607822, 0.8707216341019236, 0.86676545532457061,
    0.86275987408408694, 0.85870549596951606, 0.85460293394732079,
    0.85045280826871117, 0.84625574637587064, 0.84201238280709623,
    0.83772335910086348, 0.83338932369883667, 0.82901093184783137,
    0.82458884550075151, 0.82012373321651044, 0.815616270058954,
    0.81106713749480042, 0.80647702329061155, 0.80184662140881269,
    0.79717663190277332, 0.7924677608109707, 0.78772072005024552,
    0.78293622730816892, 0.77811500593454008, 0.77325778483202323,
    0.7683652983459498, 0.76343828615329357, 0.758477493150843,
    0.75348366934258248, 0.74845756972630151, 0.74339995417945059,
    0.73831158734425673, 0.73319323851212137, 0.72804568150731275,
    0.72286969456997574, 0.717666060238471, 0.712435565231067,
    0.70717900032699887, 0.70189716024691284, 0.69659084353271583,
    0.69126085242684687, 0.68590799275098879, 0.68053307378423888,
    0.67513690814075755, 0.6697203116469117, 0.66428410321793319,
    0.65882910473410983, 0.65335614091652849, 0.6478660392023885,
    0.64235962961990467, 0.636837744662818, 0.63130121916453463,
    0.62575089017190977, 0.62018759681869806, 0.61461218019868813,
    0.60902548323854022, 0.60342835057034794, 0.59782162840394071,
    0.59220616439894924, 0.58658280753665015, 0.58095240799161241,
    0.57531581700316159, 0.56967388674668551, 0.56402747020479549,
    0.5583774210383684, 0.55272459345748381, 0.5470698420922796,
    0.54141402186374354, 0.53575798785446094, 0.53010259517933778,
    0.524448698856319, 0.51879715367712187, 0.51314881407800261,
    0.50750453401057782, 0.50186516681271831, 0.49623156507953636,
    0.490604580534485, 0.48498506390058882, 0.47937386477182675,
    0.4737718314846846, 0.46817981098989858, 0.46259864872440754,
    0.45702918848353491, 0.45147227229341824, 0.4459287402837061,
    0.44039943056054265, 0.43488517907985663, 0.4293868195209769,
    0.42390518316059117, 0.41844109874706864, 0.41299539237516425,
    0.407568887361125, 0.40216240411821519, 0.39677676003268147,
    0.39141276934017522, 0.38607124300265128, 0.38075298858576168,
    0.37545881013676219, 0.3701895080629527, 0.36494587901066489,
    0.35972871574482168, 0.354538807029081, 0.34937693750658638,
    0.34424388758133867, 0.3391404333002106, 0.33406734623561862,
    0.32902539336887171, 0.32401533697421447, 0.31903793450358153,
    0.31409393847208128, 0.30918409634422606, 0.3043091504209251,
    0.29946983772726, 0.29466688990105527, 0.2899010330822655,
    0.28517298780319289, 0.28048346887955233, 0.27583318530240147,
    0.27122284013095055, 0.26665313038626953, 0.26212474694590859,
    0.25763837443944609, 0.25319469114498255, 0.24879436888659412,
    0.24443807293276182, 0.24012646189579223, 0.23586018763224431,
    0.23163989514437761, 0.22746622248263659, 0.2233398006491864,
    0.2192612535025138, 0.21523119766310839, 0.211250242420238,
    0.20731898963983236, 0.20343803367348962, 0.19960796126861807,
    0.19582935147972808, 0.19210277558088723, 0.18842879697935122,
    0.18480797113038444, 0.18124084545328295, 0.177727959248612,
    0.17426984361667108, 0.170867021377199, 0.16752000699033076,
    0.16422930647881784, 0.16099541735152506, 0.15781882852821355,
    0.15470002026562302, 0.1516394640848634, 0.14863762270012754,
    0.14569494994873494, 0.1428118907225176, 0.13998888090055894,
    0.13722634728329447, 0.13452470752798562, 0.1318843700855753,
    0.12930573413893637, 0.12678918954252011, 0.12433511676341558,
    0.12194388682382867, 0.11961586124498802, 0.11735139199248851,
    0.11515082142307836, 0.11301448223289995, 0.11094269740719032,
    0.10893578017145067, 0.10699403394409035, 0.10511775229055487,
    0.10330721887894206, 0.10156270743711604, 0.099884481711322914,
    0.09827279542631584, 0.09672789224699585, 0.09525000574157233,
    0.093839359346251483, 0.092496166331455187, 0.091220629769577732,
    0.0900129425042841, 0.0888732871213544, 0.0878018359210796,
    0.086798750892212118, 0.085864183687475115, 0.084998275600634943,
    0.084201157545139238, 0.083472950034324755, 0.082813763163197218,
    0.082223696591786744, 0.0817028395300804, 0.081251270724534919,
    0.08086905844617126, 0.0805562604802531, 0.080312924117550422,
    0.080139086147189731, 0.080034772851092173, 0.080000000000000016 };

  int fnz_flag;
  double InitFrame;
  double EndFrame;
  emxArray_real_T *r0;
  emxArray_boolean_T *r1;
  int l;
  int i1;
  boolean_T guard1 = false;
  double b_out[512];
  double b_win[512];
  creal_T dcv0[512];
  creal_T dcv1[512];
  double x[512];

  /*  1) Parameters of Short Time Fourier Analysis: */
  /*  1.1) Reference Sampling frequency */
  /*  1.2) Size of analysis window */
  /*  1.3) Number of overlapping samples in consecutive frames */
  /*  2) Parameters of Noise Spectrum Estimate */
  /*  2.1)  Size of frequency smoothing window function=2*w+1 */
  /*  2.2)  Recursive averaging parameter for the smoothing operation */
  /*  2.3)  Resolution of local minima search */
  /*  2.4)  Local minimum factor */
  /*  2.4)  Local minimum factor */
  /*  2.7)  Recursive averaging parameter for the noise */
  /*  3) Parameters of a Priori Probability for Signal-Absence Estimate */
  /*  3.1) Recursive averaging parameter */
  /*  3.2) Size of frequency local smoothing window function */
  /*  3.3) Size of frequency local smoothing window function */
  /*  3.4) Upper frequency threshold for global decision */
  /*  3.5) Lower frequency threshold for global decision */
  /*  3.6) Lower bound constraint */
  /*  3.7) Upper threshold for local decision */
  /*  3.8) Lower threshold for local decision */
  /*  3.9) Upper threshold for global decision */
  /*  3.10) Lower threshold for global decision */
  /*  3.11) Upper threshold for local decision */
  /*  3.12) Lower threshold for local decision */
  /*  3.13) Upper threshold for xi_m */
  /*  3.14) Lower threshold for xi_m */
  /*  3.15) Upper limit constraint */
  /*  4) Parameters of "Decision-Directed" a Priori SNR Estimate */
  /*  4.1) Recursive averaging parameter */
  /*  4.2) Lower limit constraint */
  /*  5) Flags */
  /*  broad band flag   % new version */
  /*  pure tone flag   % new version */
  /* Non stationarity  % new version */
  /*  Read input data */
  /*  Adjust parameters according to the actual sampling frequency */
  /*  Gain floor */
  /*  window function */
  /*  find a normalization factor for the window */
  memcpy(&W0[0], &dv0[0], sizeof(double) << 7);
  for (k = 0; k < 3; k++) {
    lnshift(128.0 + (double)k * 128.0, swin2_data, swin2_size);
    for (i0 = 0; i0 < 128; i0++) {
      W0[i0] += swin2_data[i0];
    }
  }

  b_W0 = sqrt(mean(W0));
  for (i = 0; i < 512; i++) {
    win[i] = A[i] / b_W0;
  }

  /* win=win/Cwin; */
  /*   number of frames */
  for (i = 0; i < 512; i++) {
    out[i] = 0.0;
  }

  /*  normalize the window function */
  /*  normalize the window function */
  /*  normalize the window function */
  /*  Upper frequency bin for global decision */
  /*  Lower frequency bin for global decision */
  /*  counter for the first frame which is non-zero    % new version omlsa3 */
  fnz_flag = 0;

  /*  flag for the first frame which is non-zero    % new version omlsa3 */
  /*  new version omlsa3 */
  /*  zero_thres is a threshold for discriminating between zero and nonzero sample. */
  /*  You may choose zero_thres=0, but then the program  handles samples which are identically zero (and not ¡°epsilon¡± values). */
  InitFrame = 1.0;
  EndFrame = 512.0;
  emxInit_real_T(&r0, 1);
  emxInit_boolean_T(&r1, 1);
  for (l = 0; l < 3997; l++) {
    if (InitFrame > EndFrame) {
      i0 = 0;
      i1 = 0;
    } else {
      i0 = (int)InitFrame - 1;
      i1 = (int)EndFrame;
    }

    i = y->size[0];
    y->size[0] = i1 - i0;
    emxEnsureCapacity((emxArray__common *)y, i, (int)sizeof(double));
    i = i1 - i0;
    for (i1 = 0; i1 < i; i1++) {
      y->data[i1] = Y_BUF[i0 + i1];
    }

    guard1 = false;
    if ((!(fnz_flag != 0)) && (fabs(Y_BUF[i0]) > 1.0E-10)) {
      guard1 = true;
    } else if (fnz_flag != 0) {
      b_abs(y, r0);
      i0 = r1->size[0];
      r1->size[0] = r0->size[0];
      emxEnsureCapacity((emxArray__common *)r1, i0, (int)sizeof(boolean_T));
      i = r0->size[0];
      for (i0 = 0; i0 < i; i0++) {
        r1->data[i0] = (r0->data[i0] > 1.0E-10);
      }

      if (any(r1)) {
        guard1 = true;
      } else {
        /*  new version omlsa3 */
        /*  new version omlsa3 */
      }
    } else {
      /*  new version omlsa3 */
      /*  new version omlsa3 */
    }

    if (guard1) {
      /*  new version omlsa3 */
      fnz_flag = 1;

      /*  new version omlsa3 */
      /*  1. Short Time Fourier Analysis */
      for (i0 = 0; i0 < 512; i0++) {
        b_win[i0] = win[i0] * y->data[i0];
      }

      fft(b_win, dcv0);
      ifft(dcv0, dcv1);
      for (i = 0; i < 512; i++) {
        x[i] = win[i] * dcv1[i].re;
      }

      for (i0 = 0; i0 < 512; i0++) {
        out[i0] += x[i0];
      }
    }

    for (i0 = 0; i0 < 384; i0++) {
      b_out[i0] = out[128 + i0];
    }

    memset(&b_out[384], 0, sizeof(double) << 7);
    for (i0 = 0; i0 < 512; i0++) {
      out[i0] = b_out[i0];
    }

    /*  update output frame */
    InitFrame += 128.0;
    EndFrame += 128.0;
  }

  emxFree_boolean_T(&r1);
  emxFree_real_T(&r0);
}

/*
 * File trailer for omlsa_new_fft.c
 *
 * [EOF]
 */
